[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

# Redirect root to /components
[[redirects]]
  from = "/"
  to = "/components"
  status = 301
  force = true

# ============ LLMs.txt and Markdown Proxies ============
# These proxy to Convex HTTP endpoints for AI agent discovery
# Note: No force=true on multi-segment patterns to allow static files to be served

# Main directory llms.txt (exact match)
[[redirects]]
  from = "/components/llms.txt"
  to = "https://giant-grouse-674.convex.site/api/llms.txt"
  status = 200
  force = true

# Main directory markdown (exact match)
[[redirects]]
  from = "/components.md"
  to = "https://giant-grouse-674.convex.site/api/markdown-index"
  status = 200
  force = true

# Per-component llms.txt (single segment like "agent")
[[redirects]]
  from = "/components/:slug/llms.txt"
  to = "https://giant-grouse-674.convex.site/api/component-llms?slug=:slug"
  status = 200
  force = true

# Per-component markdown (single segment like "agent.md")
[[redirects]]
  from = "/components/:slug.md"
  to = "https://giant-grouse-674.convex.site/api/markdown?slug=:slug"
  status = 200
  force = true

# Scoped packages llms.txt (two segments like "@scope/name/llms.txt")
# No force=true - only triggers if no static file exists at this path
[[redirects]]
  from = "/components/:scope/:name/llms.txt"
  to = "https://giant-grouse-674.convex.site/api/component-llms?slug=:scope/:name"
  status = 200

# Scoped packages markdown (two segments like "@scope/name.md")
# No force=true - only triggers if no static file exists at this path
[[redirects]]
  from = "/components/:scope/:name.md"
  to = "https://giant-grouse-674.convex.site/api/markdown?slug=:scope/:name"
  status = 200

# ============ SPA Routes ============

# Serve index.html for /components (force prevents Netlify directory trailing-slash loop)
[[redirects]]
  from = "/components"
  to = "/components/index.html"
  status = 200
  force = true

# SPA fallback - only for paths that don't match real files
# Without force=true, real files (assets, fonts) are served directly
[[redirects]]
  from = "/components/*"
  to = "/components/index.html"
  status = 200
